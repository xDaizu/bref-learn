app: '${env:APP_NAME}'
service: '${env:APP_NAME}-api'

provider:
  name: aws
  region: eu-west-2
  runtime: provided.al2

  environment:
    DATABASE_URL: 'postgresql://${env:USERNAME}:${env:PASSWORD}@${cf:${env:APP_NAME}-api-preBuild-dev.pgEndpoint}:5432/${env:DB_NAME}?charset=utf8'

plugins:
  - ./vendor/bref/bref

functions:
  api:
    handler: apps/api/public/index.php
    description: ''
    timeout: 28 # in seconds (API Gateway has a timeout of 29 seconds)
    layers:
      - ${bref:layer.php-74-fpm}
    events:
      - httpApi: '*'

# Exclude files from deployment
package:
  patterns:
    - '!node_modules/**'
    - '!tests/**'
